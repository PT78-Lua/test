
local getgenv = getgenv or function() return _G end
getgenv().ScriptName = "RWBY PT78"

local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local MarketplaceService = game:GetService("MarketplaceService")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer

-- Cleanup old instances
if CoreGui:FindFirstChild("RWBY_UI") then
    CoreGui:FindFirstChild("RWBY_UI"):Destroy()
end

-- Load GUI asset
local success, Y = pcall(function() 
    return game:GetObjects("rbxassetid://12702460854")[1] 
end)

if not success or not Y then 
    warn("Failed to load GUI Asset") 
    return 
end

Y.Name = "RWBY_UI"
Y.bg.Position = UDim2.new(0.5, -Y.bg.Size.X.Offset/2, 0.5, -Y.bg.Size.Y.Offset/2)
Y.Parent = CoreGui

-- Update title
local gameName = MarketplaceService:GetProductInfo(game.PlaceId).Name
Y.bg.pre.Text = 'RWBY<font color="#8B0000">.PT78</font> - [Alpha] - ' .. gameName

-- Draggable Logic
local dragging, dragInput, dragStart, startPos
Y.bg.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = Y.bg.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then dragging = false end
        end)
    end
end)

Y.bg.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        Y.bg.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- Library core
local W = {
    tabs = {},
    tabbuttons = {},
    options = {},
    flags = {},
    toInvis = {},
    multiZindex = 200,
    libColor = Color3.fromRGB(139, 0, 0),
    disabledcolor = Color3.fromRGB(233, 0, 0),
    colorpicking = false,
    scrolling = false,
    playing = false,
    blacklisted = {Enum.KeyCode.W, Enum.KeyCode.A, Enum.KeyCode.S, Enum.KeyCode.D, Enum.UserInputType.MouseMovement, Enum.KeyCode.Unknown}
}

-- Tween helper
function W:Tween(obj, tweenInfo, props)
    TweenService:Create(obj, tweenInfo or TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), props):Play()
end

-- Tab system
local mainGroup = Y.bg.bg.bg.bg.main.group
local tabButtonsContainer = Y.bg.bg.bg.bg.tabbuttons

-- Clear placeholder children from asset
for _, v in pairs(mainGroup:GetChildren()) do 
    if v.Name == "tab" and v.Visible then v.Visible = false end 
end
for _, v in pairs(tabButtonsContainer:GetChildren()) do 
    if v:IsA("TextButton") then v:Destroy() end 
end

function W.addTab(self, tabName)
    local tab = mainGroup:FindFirstChild("tab") and mainGroup.tab:Clone() or Instance.new("Frame")
    -- Fallback if asset structure differs, but assuming asset is valid:
    
    local button = tabButtonsContainer:FindFirstChild("button") 
    if not button then 
        -- Create button from scratch if asset is missing it
        button = Instance.new("TextButton")
        button.Name = "button"
        local t = Instance.new("TextLabel", button)
        t.Name = "text"
        local e = Instance.new("Frame", button)
        e.Name = "element"
    else
        button = button:Clone()
    end

    table.insert(self.tabs, tab)
    tab.Parent = mainGroup
    tab.Visible = false
    tab.Name = tabName .. "_Tab"

    table.insert(self.tabbuttons, button)
    button.Parent = tabButtonsContainer
    button.Modal = true
    button.Visible = true
    button.text.Text = tabName

    button.MouseButton1Click:Connect(function()
        for _, t in next, self.tabs do t.Visible = (t == tab) end
        for _, inv in next, self.toInvis do inv.Visible = false end

        for _, b in next, self.tabbuttons do
            local isActive = (b == button)
            if isActive then
                b.element.Visible = true
                self:Tween(b.element, nil, {BackgroundTransparency = 0, BackgroundColor3 = Color3.fromRGB(139,0,0)})
            else
                self:Tween(b.element, nil, {BackgroundTransparency = 1})
            end
        end
    end)

    -- Return group creator
    local groupLib = {}
    local zIndexCounter = 100

    function groupLib.createGroup(side, title)
        zIndexCounter = zIndexCounter - 1

        local group = Instance.new("Frame")
        local inner = Instance.new("Frame")
        local accentBar = Instance.new("Frame")
        local titleLabel = Instance.new("TextLabel")
        local underline = Instance.new("Frame")

        group.Parent = tab[side or "left"]
        group.BackgroundColor3 = Color3.fromRGB(255,255,255)
        group.BorderColor3 = Color3.fromRGB(30,30,30)
        group.BorderSizePixel = 2
        group.Size = UDim2.new(0, 211, 0, 30) -- Start height
        group.ZIndex = zIndexCounter
        group.Name = title or "Group"

        inner.Parent = group
        inner.BackgroundColor3 = Color3.fromRGB(20,20,20)
        inner.BorderColor3 = Color3.fromRGB(0,0,0)
        inner.Size = UDim2.new(1,0,1,0)
        inner.ClipsDescendants = false -- Allow dropdowns/pickers to overflow if needed

        accentBar.Name = "element"
        accentBar.Parent = group
        accentBar.BackgroundColor3 = self.libColor
        accentBar.BorderSizePixel = 0
        accentBar.Size = UDim2.new(1,0,0,1)

        titleLabel.Parent = group
        titleLabel.BackgroundTransparency = 1
        titleLabel.Position = UDim2.new(0,17,0,0)
        titleLabel.ZIndex = 2
        titleLabel.Font = Enum.Font.Code
        titleLabel.Text = title or ""
        titleLabel.TextColor3 = Color3.fromRGB(255,255,255)
        titleLabel.TextSize = 13
        titleLabel.TextStrokeTransparency = 0
        titleLabel.TextXAlignment = Enum.TextXAlignment.Left

        underline.Parent = group
        underline.BackgroundColor3 = Color3.fromRGB(20,20,20)
        underline.BorderSizePixel = 0
        underline.Position = UDim2.new(0,10,0,-2)
        underline.Size = UDim2.new(0, 13 + titleLabel.TextBounds.X, 0, 3)

        -- Controls container - using manual positioning
        local controls = {}
        local currentY = 25 -- Start below title
        
        -- Helper function to position controls
        local function addControl(height)
            local newHeight = currentY + height + 5
            group.Size = UDim2.new(0, 211, 0, newHeight)
            currentY = currentY + height + 5
        end

        function controls.addToggle(options)
            local flag = options.flag or options.text
            if not flag then return end

            local frame = Instance.new("Frame")
            local outer = Instance.new("Frame")
            local mid = Instance.new("Frame")
            local front = Instance.new("Frame")
            local label = Instance.new("TextLabel")
            local clickArea = Instance.new("TextButton")

            frame.Name = "toggleframe"
            frame.Parent = inner
            frame.BackgroundTransparency = 1
            frame.Size = UDim2.new(1, -10, 0, 20)
            frame.Position = UDim2.new(0, 5, 0, currentY)
            frame.ZIndex = self.multiZindex - 1

            outer.Name = "tobble"
            outer.Parent = frame
            outer.BackgroundColor3 = Color3.fromRGB(255,255,255)
            outer.BorderColor3 = Color3.fromRGB(0,0,0)
            outer.BorderSizePixel = 3
            outer.Position = UDim2.new(0,0,0,3)
            outer.Size = UDim2.new(0,10,0,10)

            mid.Name = "mid"
            mid.Parent = outer
            mid.BackgroundColor3 = Color3.fromRGB(30,30,30) -- Default dark
            mid.BorderColor3 = Color3.fromRGB(30,30,30)
            mid.BorderSizePixel = 2
            mid.Size = UDim2.new(0,10,0,10)

            front.Name = "front"
            front.Parent = mid
            front.BackgroundColor3 = Color3.fromRGB(15,15,15)
            front.BorderColor3 = Color3.fromRGB(0,0,0)
            front.Size = UDim2.new(0,10,0,10)

            label.Name = "text"
            label.Parent = frame
            label.BackgroundTransparency = 1
            label.Position = UDim2.new(0,22,0,0)
            label.Size = UDim2.new(1, -30,1,0)
            label.Font = Enum.Font.Code
            label.Text = options.text or flag
            label.TextColor3 = Color3.fromRGB(155,155,155)
            label.TextSize = 13
            label.TextStrokeTransparency = 0
            label.TextXAlignment = Enum.TextXAlignment.Left

            clickArea.Name = "button"
            clickArea.Parent = frame
            clickArea.BackgroundTransparency = 1
            clickArea.Size = UDim2.new(1,0,1,0)
            clickArea.Text = ""

            local toggled = options.Default or false

            local function updateToggle(state)
                toggled = state
                self.flags[flag] = state
                
                -- Visual updates
                if state then
                    mid.BackgroundColor3 = self.libColor
                    front.BackgroundColor3 = self.libColor
                    label.TextColor3 = Color3.fromRGB(244,244,244)
                else
                    mid.BackgroundColor3 = Color3.fromRGB(30,30,30)
                    front.BackgroundColor3 = Color3.fromRGB(15,15,15)
                    label.TextColor3 = Color3.fromRGB(144,144,144)
                end
                
                if options.callback then options.callback(state) end
            end

            clickArea.MouseButton1Click:Connect(function()
                updateToggle(not toggled)
            end)

            clickArea.MouseEnter:Connect(function()
                if not toggled then
                    mid.BorderColor3 = self.libColor
                end
            end)

            clickArea.MouseLeave:Connect(function()
                mid.BorderColor3 = Color3.fromRGB(30,30,30)
            end)

            self.flags[flag] = toggled
            updateToggle(toggled)

            addControl(20)
            return {Toggle = updateToggle}
        end

        function controls.addSlider(options)
            local flag = options.flag or options.text
            if not flag then return end

            local frame = Instance.new("Frame")
            local bg = Instance.new("Frame")
            local main = Instance.new("Frame")
            local label = Instance.new("TextLabel")
            local valueLabel = Instance.new("TextLabel")
            local fill = Instance.new("Frame")
            local knob = Instance.new("Frame")
            local sliderBtn = Instance.new("TextButton")

            frame.Name = "sliderframe"
            frame.Parent = inner
            frame.BackgroundTransparency = 1
            frame.Size = UDim2.new(1, -10, 0, 38)
            frame.Position = UDim2.new(0, 5, 0, currentY)

            bg.Name = "bg"
            bg.Parent = frame
            bg.BackgroundColor3 = Color3.fromRGB(35,35,35)
            bg.BorderColor3 = Color3.fromRGB(0,0,0)
            bg.BorderSizePixel = 2
            bg.Position = UDim2.new(0,0,0,20)
            bg.Size = UDim2.new(1,0,0,15)

            main.Name = "main"
            main.Parent = bg
            main.BackgroundColor3 = Color3.fromRGB(35,35,35)
            main.BorderColor3 = Color3.fromRGB(60,60,60)
            main.Size = UDim2.new(1,0,1,0)

            label.Name = "text"
            label.Parent = frame
            label.BackgroundTransparency = 1
            label.Position = UDim2.new(0,0,0,0)
            label.Size = UDim2.new(1,0,0,16)
            label.Font = Enum.Font.Code
            label.Text = options.text or flag
            label.TextColor3 = Color3.fromRGB(155,155,155)
            label.TextSize = 13
            label.TextStrokeTransparency = 0
            label.TextXAlignment = Enum.TextXAlignment.Left

            valueLabel.Name = "value"
            valueLabel.Parent = frame
            valueLabel.BackgroundTransparency = 1
            valueLabel.Position = UDim2.new(0,0,0,0)
            valueLabel.Size = UDim2.new(1,-5,0,16)
            valueLabel.Font = Enum.Font.Code
            valueLabel.Text = tostring(options.value or options.Default or 0)
            valueLabel.TextColor3 = Color3.fromRGB(155,155,155)
            valueLabel.TextSize = 13
            valueLabel.TextStrokeTransparency = 0
            valueLabel.TextXAlignment = Enum.TextXAlignment.Right

            fill.Name = "fill"
            fill.Parent = main
            fill.BackgroundColor3 = self.libColor
            fill.BorderSizePixel = 0
            fill.Size = UDim2.new(0,0,1,0)
            
            knob.Name = "knob"
            knob.Parent = main
            knob.BackgroundColor3 = Color3.fromRGB(255,255,255)
            knob.BorderColor3 = Color3.fromRGB(60,60,60)
            knob.BorderSizePixel = 1
            knob.Size = UDim2.new(0,6,1,2)
            knob.Position = UDim2.new(0,0,0,-1)
            knob.ZIndex = 2

            sliderBtn.Name = "button"
            sliderBtn.Parent = main
            sliderBtn.BackgroundTransparency = 1
            sliderBtn.Size = UDim2.new(1,0,1,0)
            sliderBtn.Text = ""

            local min = options.min or 0
            local max = options.max or 100
            local step = options.step or 1
            local current = options.value or options.Default or 50
            local dragging = false

            local function updateSlider(val)
                val = math.clamp(val, min, max)
                if step > 0 then
                    val = math.floor(val / step) * step
                end
                current = val
                self.flags[flag] = current
                valueLabel.Text = tostring(current)
                local percent = (current - min) / (max - min)
                fill.Size = UDim2.new(percent, 0, 1, 0)
                knob.Position = UDim2.new(percent, -3, 0, -1)
                if options.callback then options.callback(current) end
            end

            local function move(input)
                local pos = input.Position.X
                local percent = math.clamp((pos - main.AbsolutePosition.X) / main.AbsoluteSize.X, 0, 1)
                local value = min + (max - min) * percent
                updateSlider(value)
            end

            sliderBtn.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    dragging = true
                    knob.BackgroundColor3 = Color3.fromRGB(200,200,200)
                    move(input)
                    
                    local con
                    con = input.Changed:Connect(function()
                        if input.UserInputState == Enum.UserInputState.End then
                            dragging = false
                            knob.BackgroundColor3 = Color3.fromRGB(255,255,255)
                            con:Disconnect()
                        end
                    end)
                end
            end)

            UserInputService.InputChanged:Connect(function(input)
                if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                    move(input)
                end
            end)

            updateSlider(current)
            addControl(38)
            return {Set = updateSlider, Get = function() return current end}
        end

        function controls.addButton(options)
            local frame = Instance.new("Frame")
            local bg = Instance.new("Frame")
            local main = Instance.new("Frame")
            local btn = Instance.new("TextButton")
            local clickEffect = Instance.new("Frame")

            frame.Name = "buttonframe"
            frame.Parent = inner
            frame.BackgroundTransparency = 1
            frame.Size = UDim2.new(1, -10, 0, 22)
            frame.Position = UDim2.new(0, 5, 0, currentY)

            bg.Name = "bg"
            bg.Parent = frame
            bg.BackgroundColor3 = Color3.fromRGB(35,35,35)
            bg.BorderColor3 = Color3.fromRGB(0,0,0)
            bg.BorderSizePixel = 2
            bg.Position = UDim2.new(0,0,0,3)
            bg.Size = UDim2.new(1,0,0,18)

            main.Name = "main"
            main.Parent = bg
            main.BackgroundColor3 = Color3.fromRGB(35,35,35)
            main.BorderColor3 = Color3.fromRGB(60,60,60)
            main.Size = UDim2.new(1,0,1,0)
            main.ClipsDescendants = true

            btn.Name = "button"
            btn.Parent = main
            btn.BackgroundTransparency = 1
            btn.Size = UDim2.new(1,0,1,0)
            btn.Font = Enum.Font.Code
            btn.Text = options.text or "Button"
            btn.TextColor3 = Color3.fromRGB(255,255,255)
            btn.TextSize = 13
            btn.TextStrokeTransparency = 0
            btn.TextXAlignment = Enum.TextXAlignment.Center

            clickEffect.Name = "clickEffect"
            clickEffect.Parent = main
            clickEffect.BackgroundColor3 = Color3.fromRGB(255,255,255)
            clickEffect.BorderSizePixel = 0
            clickEffect.Size = UDim2.new(0,0,1,0)
            clickEffect.Position = UDim2.new(0,0,0,0)
            clickEffect.Visible = false

            btn.MouseEnter:Connect(function()
                W:Tween(main, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(45,45,45)})
                btn.TextColor3 = Color3.fromRGB(255,255,200)
            end)

            btn.MouseLeave:Connect(function()
                W:Tween(main, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(35,35,35)})
                btn.TextColor3 = Color3.fromRGB(255,255,255)
            end)

            btn.MouseButton1Down:Connect(function()
                clickEffect.Visible = true
                clickEffect.BackgroundTransparency = 0.6
                clickEffect.Size = UDim2.new(0,0,1,0)
                
                W:Tween(clickEffect, TweenInfo.new(0.3), {
                    Size = UDim2.new(1,0,1,0),
                    BackgroundTransparency = 1
                })
                
                btn.TextColor3 = Color3.fromRGB(200,200,200)
                W:Tween(main, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(55,55,55)})
            end)

            btn.MouseButton1Up:Connect(function()
                btn.TextColor3 = Color3.fromRGB(255,255,255)
                W:Tween(main, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(45,45,45)})
            end)

            btn.MouseButton1Click:Connect(function()
                if options.callback then options.callback() end
            end)

            addControl(22)
        end

        function controls.addKeybind(options)
            local flag = options.flag or options.text
            if not flag then return end

            local frame = Instance.new("Frame")
            local label = Instance.new("TextLabel")
            local keyLabel = Instance.new("TextButton")

            frame.Parent = inner
            frame.BackgroundTransparency = 1
            frame.Size = UDim2.new(1, -10, 0, 20)
            frame.Position = UDim2.new(0, 5, 0, currentY)

            label.Parent = frame
            label.BackgroundTransparency = 1
            label.Size = UDim2.new(0.7, 0, 1, 0)
            label.Font = Enum.Font.Code
            label.Text = options.text or "Keybind"
            label.TextColor3 = Color3.fromRGB(200,200,200)
            label.TextSize = 13
            label.TextXAlignment = Enum.TextXAlignment.Left

            keyLabel.Parent = frame
            keyLabel.BackgroundColor3 = Color3.fromRGB(35,35,35)
            keyLabel.BorderColor3 = Color3.fromRGB(60,60,60)
            keyLabel.BorderSizePixel = 1
            keyLabel.Position = UDim2.new(0.7, 0, 0.15, 0)
            keyLabel.Size = UDim2.new(0.3, -5, 0.7, 0)
            keyLabel.Font = Enum.Font.Code
            keyLabel.Text = "[None]"
            keyLabel.TextColor3 = Color3.fromRGB(200,200,200)
            keyLabel.TextSize = 12
            keyLabel.AutoButtonColor = false

            local listening = false
            local currentKey = options.key or Enum.KeyCode.Unknown

            local function updateKey(key)
                currentKey = key
                local kName = (key.Name == "Unknown" or key.Name == "Reserved") and "None" or key.Name
                keyLabel.Text = "[" .. kName .. "]"
                self.flags[flag] = key
                if options.callback then options.callback(key) end
            end

            keyLabel.MouseButton1Click:Connect(function()
                if listening then return end
                listening = true
                keyLabel.Text = "[...]"
                keyLabel.TextColor3 = Color3.fromRGB(255,100,100)
                
                local connection
                connection = UserInputService.InputBegan:Connect(function(input)
                    -- Filter unwanted inputs
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then return end
                    
                    local key = input.KeyCode
                    if key == Enum.KeyCode.Unknown then
                         -- Handle mouse buttons if needed, usually mapped to specific Enums
                         if input.UserInputType == Enum.UserInputType.MouseButton2 then
                             key = Enum.KeyCode.F2 -- Map RMB if desired, or just ignore
                         end
                    end
                    
                    if input.UserInputType == Enum.UserInputType.Keyboard or input.UserInputType == Enum.UserInputType.MouseButton2 or input.UserInputType == Enum.UserInputType.MouseButton3 then
                        listening = false
                        keyLabel.TextColor3 = Color3.fromRGB(200,200,200)
                        
                        -- Prevent binding Escape
                        if key == Enum.KeyCode.Escape then
                            updateKey(currentKey) -- Cancel
                        else
                            updateKey(key)
                        end
                        
                        connection:Disconnect()
                    end
                end)
            end)

            updateKey(currentKey)
            addControl(20)
            
            return {
                Set = function(key) updateKey(key) end,
                Get = function() return currentKey end
            }
        end

        function controls.addColorpicker(options)
            local flag = options.flag or options.text
            if not flag then return end

            local container = Instance.new("Frame")
            local label = Instance.new("TextLabel")
            local preview = Instance.new("TextButton")
            local hexInput = Instance.new("TextBox")

            container.Parent = inner
            container.BackgroundTransparency = 1
            container.Size = UDim2.new(1, -10, 0, 24)
            container.Position = UDim2.new(0, 5, 0, currentY)

            label.Parent = container
            label.BackgroundTransparency = 1
            label.Size = UDim2.new(0.6, 0, 1, 0)
            label.Font = Enum.Font.Code
            label.Text = options.text or "Color Picker"
            label.TextColor3 = Color3.fromRGB(200,200,200)
            label.TextSize = 13
            label.TextXAlignment = Enum.TextXAlignment.Left

            preview.Parent = container
            preview.BackgroundColor3 = options.Default or Color3.fromRGB(255,0,0)
            preview.BorderColor3 = Color3.fromRGB(60,60,60)
            preview.BorderSizePixel = 1
            preview.Position = UDim2.new(0.6, 0, 0.2, 0)
            preview.Size = UDim2.new(0.4, -5, 0.6, 0)
            preview.AutoButtonColor = false
            preview.Text = ""

            -- Picker frame (The Dropdown)
            local pickerFrame = Instance.new("Frame")
            pickerFrame.Name = "picker_" .. flag
            pickerFrame.Parent = Y.bg -- Parent to main GUI to render on top
            pickerFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
            pickerFrame.BorderColor3 = Color3.fromRGB(0,0,0)
            pickerFrame.BorderSizePixel = 2
            pickerFrame.Size = UDim2.new(0,180,0,160)
            pickerFrame.Visible = false
            pickerFrame.ZIndex = 200

            -- SV (Saturation/Value) Box
            local svBox = Instance.new("Frame")
            svBox.Parent = pickerFrame
            svBox.BorderSizePixel = 0
            svBox.Size = UDim2.new(1, -40, 1, -40)
            svBox.Position = UDim2.new(0,10,0,10)
            svBox.BackgroundColor3 = Color3.fromRGB(255,0,0) 
            svBox.ZIndex = 201

            local satGrad = Instance.new("UIGradient")
            satGrad.Parent = svBox
            satGrad.Color = ColorSequence.new(Color3.new(1,1,1), Color3.new(1,0,0)) -- Will be updated
            satGrad.Transparency = NumberSequence.new(0)
            
            local valOverlay = Instance.new("Frame")
            valOverlay.Parent = svBox
            valOverlay.Size = UDim2.new(1,0,1,0)
            valOverlay.BackgroundColor3 = Color3.new(1,1,1)
            valOverlay.BorderSizePixel = 0
            valOverlay.ZIndex = 202
            
            local valGrad = Instance.new("UIGradient")
            valGrad.Parent = valOverlay
            valGrad.Color = ColorSequence.new(Color3.new(0,0,0), Color3.new(0,0,0))
            valGrad.Transparency = NumberSequence.new{
                NumberSequenceKeypoint.new(0, 1),
                NumberSequenceKeypoint.new(1, 0)
            }
            valGrad.Rotation = 90

            valOverlay.Active = false
            valOverlay.Selectable = false

            local svKnob = Instance.new("Frame")
            svKnob.Parent = svBox
            svKnob.Size = UDim2.new(0,4,0,4)
            svKnob.BackgroundColor3 = Color3.new(1,1,1)
            svKnob.BorderColor3 = Color3.new(0,0,0)
            svKnob.Rotation = 45
            svKnob.ZIndex = 205

            svKnob.Active = false
            svKnob.Selectable = false

            -- Hue Bar
            local hueBar = Instance.new("Frame")
            hueBar.Parent = pickerFrame
            hueBar.Size = UDim2.new(0, 20, 1, -40)
            hueBar.Position = UDim2.new(1, -30, 0, 10)
            hueBar.BorderSizePixel = 0
            hueBar.BackgroundColor3 = Color3.new(1,1,1)
            hueBar.ZIndex = 201

            local hueGrad = Instance.new("UIGradient")
            hueGrad.Parent = hueBar
            hueGrad.Rotation = 90
            hueGrad.Color = ColorSequence.new{
                ColorSequenceKeypoint.new(0, Color3.fromRGB(255,0,0)),
                ColorSequenceKeypoint.new(0.167, Color3.fromRGB(255,0,255)),
                ColorSequenceKeypoint.new(0.333, Color3.fromRGB(0,0,255)),
                ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0,255,255)),
                ColorSequenceKeypoint.new(0.667, Color3.fromRGB(0,255,0)),
                ColorSequenceKeypoint.new(0.833, Color3.fromRGB(255,255,0)),
                ColorSequenceKeypoint.new(1, Color3.fromRGB(255,0,0))
            }

            local hueKnob = Instance.new("Frame")
            hueKnob.Parent = hueBar
            hueKnob.Size = UDim2.new(1,0,0,2)
            hueKnob.BackgroundColor3 = Color3.new(1,1,1)
            hueKnob.BorderSizePixel = 1
            hueKnob.BorderColor3 = Color3.new(0,0,0)
            hueKnob.ZIndex = 205

            hueKnob.Active = false
            hueKnob.Selectable = false

            -- Values
            local h, s, v = Color3.toHSV(options.Default or Color3.fromRGB(255,0,0))
            
            local function update()
                local color = Color3.fromHSV(h,s,v)
                preview.BackgroundColor3 = color
                svBox.BackgroundColor3 = Color3.fromHSV(h, 1, 1)
                
                -- Update Gradients
                -- SV Box gradient moves from White to Pure Color
                satGrad.Color = ColorSequence.new(Color3.new(1,1,1), Color3.fromHSV(h, 1, 1))

                self.flags[flag] = color
                if options.callback then options.callback(color) end
            end

            -- Hue Logic
            local hueDragging = false
            hueBar.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    hueDragging = true
                end
            end)
            
            hueBar.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then hueDragging = false end
            end)

            -- SV Logic
            local svDragging = false
            svBox.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    svDragging = true
                end
            end)
            
            svBox.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then svDragging = false end
            end)

            UserInputService.InputChanged:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseMovement then
                    if hueDragging then
                        local y = math.clamp((input.Position.Y - hueBar.AbsolutePosition.Y) / hueBar.AbsoluteSize.Y, 0, 1)
                        hueKnob.Position = UDim2.new(0,0,y,0)
                        h = 1 - y
                        update()
                    end
                    
                    if svDragging then
                        local x = math.clamp((input.Position.X - svBox.AbsolutePosition.X) / svBox.AbsoluteSize.X, 0, 1)
                        local y = math.clamp((input.Position.Y - svBox.AbsolutePosition.Y) / svBox.AbsoluteSize.Y, 0, 1)
                        
                        svKnob.Position = UDim2.new(x,-2,y,-2)
                        s = x
                        v = 1 - y
                        update()
                    end
                end
            end)

            preview.MouseButton1Click:Connect(function()
                pickerFrame.Visible = not pickerFrame.Visible
                if pickerFrame.Visible then
                    -- Position correctly
                    pickerFrame.Position = UDim2.new(0, preview.AbsolutePosition.X + preview.AbsoluteSize.X + 10, 0, preview.AbsolutePosition.Y)
                end
            end)

            -- Initial Set
            update()
            
            addControl(24)
            return {
                Set = function(c) 
                    h,s,v = Color3.toHSV(c)
                    update()
                end,
                Get = function() return Color3.fromHSV(h,s,v) end
            }
        end

        function controls.addLabel(text)
            local lbl = Instance.new("TextLabel")
            lbl.Parent = inner
            lbl.BackgroundTransparency = 1
            lbl.Size = UDim2.new(1, -10, 0, 20)
            lbl.Position = UDim2.new(0, 5, 0, currentY)
            lbl.Font = Enum.Font.Code
            lbl.Text = text or ""
            lbl.TextColor3 = Color3.fromRGB(180,180,180)
            lbl.TextSize = 13
            lbl.TextStrokeTransparency = 0.8
            lbl.TextXAlignment = Enum.TextXAlignment.Left
            
            addControl(20)
        end

        return controls
    end

    return groupLib
end

-- Create tabs
local mainTab = W.addTab(W, "Main")
local rageTab = W.addTab(W, "Ragebot")
local visTab  = W.addTab(W, "Visuals")
local miscTab = W.addTab(W, "Misc")

-- Open first tab
if #W.tabs > 0 then
    W.tabs[1].Visible = true
    W.tabbuttons[1].element.BackgroundTransparency = 0
    W.tabbuttons[1].element.BackgroundColor3 = Color3.fromRGB(139, 0, 0)
end

-- EXAMPLE USAGE --
local leftGroup = mainTab.createGroup("left", "Main Features")

leftGroup.addToggle({
    text = "Enable Aimbot",
    flag = "aimbot_enabled",
    Default = false,
    callback = function(v) print("Aimbot:", v) end
})

leftGroup.addSlider({
    text = "FOV Radius",
    flag = "fov_radius",
    min = 0, max = 500, Default = 100,
    callback = function(v) print("FOV:", v) end
})


leftGroup.addButton({
    text = "Unload",
    callback = function()
        Y:Destroy()
    end
})
